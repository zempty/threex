package com.zhu2chu.all.bus.kit;

import java.math.BigDecimal;

/**
 * 暴雪哈希
 * Created by zouxiaoliang on 2017/3/21.
 */
public class StormHash {

    /**
     * 散列hash表
     */
    private static long [] cryptTable = {
            1439053538L, 46006640L, 1481339348L, 696578062L, 3062024201L, 2446296939L, 2002426916L, 1501387941L, 1511718578L, 3555315213L,
            852348408L, 2978087373L, 1020134862L, 2774340542L, 3138059889L, 2474027827L, 2223989854L, 2279889477L, 1169711127L, 1583705256L,
            461707925L, 625138647L, 2874014180L, 1500950171L, 1815182973L, 3453824916L, 1010570213L, 861606769L, 832934602L, 1373961292L,
            4158348079L, 2327690817L, 2347411060L, 550941465L, 3731659421L, 3316417765L, 1146773483L, 2492828848L, 511522887L, 4082969008L,
            3395079898L, 3073558709L, 4258021853L, 249359382L, 2634153646L, 291885966L, 2665583560L, 3207835964L, 1639714300L, 4013849577L,
            4174697669L, 3348854420L, 1512397123L, 188600842L, 2635773347L, 3483941463L, 1584230505L, 3414800177L, 1036046683L, 223182462L,
            2548268843L, 4277939121L, 4183496373L, 665148307L, 1173497641L, 1285056048L, 2087086178L, 1604585543L, 2750505477L, 2031843172L,
            946550486L, 1852588015L, 3344455131L, 1253866951L, 1244827547L, 3471969295L, 1622707975L, 4156246927L, 2198557074L, 2499219948L,
            539297618L, 966599075L, 3854599181L, 3882680229L, 1649388329L, 1576088550L, 2212542904L, 3313069051L, 1249555152L, 3126437921L,
            61349452L, 3443187675L, 850553740L, 2385888563L, 2657288425L, 2365139653L, 2282559723L, 320492467L, 785570916L, 2989643713L,
            2690928833L, 462605198L, 1928164110L, 430343664L, 2189649027L, 1121537674L, 4003190518L, 1433209706L, 3127203994L, 3726953700L,
            1395826540L, 3344236171L, 1346186695L, 268598180L, 3551922827L, 1759939971L, 177285289L, 1499439967L, 184792510L, 352994756L,
            2976029902L, 3858188667L, 2322634916L, 3089317481L, 2392914296L, 1532467568L, 3937485592L, 1260958307L, 3061214447L, 108537975L,
            358378960L, 3339793212L, 4162440927L, 15408488L, 3607100014L, 1134451042L, 3613775579L, 3406548713L, 1832670791L, 2522113779L,
            212435913L, 1961673166L, 4228211638L, 1118867438L, 3316877395L, 4266667243L, 2068000687L, 3272205840L, 741971928L, 1131890260L,
            364748076L, 3983163917L, 3355398668L, 3098116049L, 1582129356L, 3111357713L, 3659629055L, 1940661655L, 982445197L, 2894456697L,
            4093212118L, 3120462737L, 253058334L, 677426909L, 2203678667L, 2959111222L, 2628484971L, 2327384454L, 3240841705L, 537415307L,
            1153076909L, 2772611376L, 2193413572L, 3430186830L, 253299160L, 3659804188L, 1870469792L, 3529663622L, 2295363614L, 2875808973L,
            4199977285L, 3036591452L, 3192383638L, 3876223624L, 3579938210L, 2901723249L, 153625394L, 501148328L, 1493990107L, 4104746599L,
            3218626309L, 245857484L, 2851623780L, 2199476329L, 2348483610L, 3682873180L, 3606115093L, 2809491111L, 173126713L, 2850945187L,
            3641200175L, 2188642296L, 3568075396L, 158571789L, 3015404796L, 3577333629L, 1807522496L, 902185386L, 2471270064L, 3514495767L,
            700889839L, 2994064812L, 3609617118L, 2673616196L, 3249114997L, 3649998746L, 1203592326L, 1892028582L, 3041406676L, 599377548L,
            1008447078L, 1767206527L, 3640849888L, 1698503003L, 3731177979L, 129812140L, 3337516936L, 2148873428L, 740242880L, 3655229773L,
            3184307333L, 3033833690L, 606950555L, 2643871638L, 3117332866L, 1509595561L, 3633867969L, 2660286881L, 29087791L, 3622946301L,
            3716447930L, 2285711453L, 636563794L, 1251109197L, 2012341761L, 2149902055L, 44430653L, 2621371609L, 2940222668L, 3802989504L,
            1190000364L, 1872483302L, 3424955770L, 1202694930L, 2183761399L, 1888263916L, 1996014001L, 3012843986L, 1058940633L, 3783334887L,
            1458379853L, 3385953016L, 3894937102L, 2445990446L, 1556871607L, 4054143700L, 1016939331L, 3774908293L, 719318719L, 4177674400L,
            1023986919L, 1114533808L, 1463588943L, 329794478L, 1080783929L, 1667270105L, 1342225050L, 2907326379L, 2936020365L, 1100548014L,
            408719254L, 3857313101L, 1635139891L, 3547348375L, 2895704262L, 3687031676L, 2247102660L, 2420710962L, 4046330047L, 3364656865L,
            3556497113L, 3821177608L, 3586066636L, 2984740953L, 625401295L, 2955981312L, 2868717585L, 1437740321L, 3549164903L, 1184660011L,
            1523603346L, 2711984158L, 2113635204L, 886163978L, 2125519840L, 3592216822L, 964716727L, 3862981919L, 2511235911L, 3827831344L,
            2961453153L, 2802465384L, 3812685349L, 1927069693L, 2394468301L, 414606879L, 401562204L, 809762L, 1805727798L, 1634067331L,
            1950882907L, 3849258769L, 2725204004L, 1609707104L, 832956457L, 2701741040L, 3330337900L, 2364745687L, 3958453386L, 1780645167L,
            1946571140L, 2381730066L, 733808110L, 3838840534L, 696315418L, 1793186419L, 3896906970L, 1821968043L, 3482190555L, 3547479703L,
            2465623215L, 2894369223L, 2932233878L, 3112802255L, 4195796834L, 1836303967L, 542974630L, 1305717413L, 770403264L, 2671208556L,
            1906649131L, 929806816L, 2147428891L, 3731331119L, 2629776334L, 778939191L, 1848911033L, 249643964L, 2200592601L, 3143838177L,
            334937853L, 1499855748L, 4127925052L, 1030312323L, 1127359649L, 3050949349L, 2185599915L, 2669785873L, 2943111751L, 3024597306L,
            2066118339L, 3280566733L, 2233904677L, 3310398811L, 1750112679L, 1709818557L, 3855014966L, 3775608745L, 2281793656L, 3464615140L,
            618069120L, 1090917677L, 1833918352L, 3302782142L, 3678955372L, 1823828407L, 4089403791L, 69929177L, 46969566L, 2969923429L,
            1201228532L, 4195621796L, 2474027822L, 128411447L, 1978132220L, 1151172769L, 62334365L, 4141823370L, 1517671865L, 1193830691L,
            991572207L, 4005444970L, 2645666304L, 8032473L, 610693233L, 27030479L, 1761844173L, 2509244228L, 1696117227L, 1761997314L,
            3996733874L, 3779198121L, 2038409266L, 1519773019L, 3592829717L, 1533146004L, 2306525980L, 6259625L, 574754673L, 4103411566L,
            2115211069L, 328393604L, 926676906L, 2387683350L, 2841686986L, 74766156L, 4289517271L, 787869086L, 1620650666L, 2120814233L,
            599815325L, 3638726917L, 1432181001L, 358816766L, 2795264540L, 1343231946L, 2571337800L, 947075783L, 3867337416L, 3563413462L,
            2507033604L, 880670275L, 793450363L, 2481797796L, 2810060245L, 2061850370L, 3534041049L, 4018905484L, 3084108270L, 2155395725L,
            2874845915L, 1965809807L, 109785537L, 126529084L, 2858058563L, 306025064L, 753593923L, 2394796601L, 1694650867L, 76035656L,
            2355290414L, 313729383L, 3843108506L, 268445000L, 1048215949L, 125719335L, 4047555617L, 1827133277L, 2610559397L, 840266780L,
            3064650670L, 1938254044L, 2191750191L, 1985048608L, 3716623064L, 2634613426L, 2098883332L, 1228412306L, 1671844517L, 202761766L,
            3794759894L, 31998853L, 2996691252L, 549781518L, 3915510851L, 758212142L, 1021754408L, 888790420L, 4198882899L, 1232439485L,
            2489852251L, 125303388L, 1869681856L, 3773310612L, 3828816262L, 1460743650L, 3771384457L, 4070821600L, 1782702521L, 3217991549L,
            4180147538L, 1769242008L, 3198643419L, 2379453783L, 81485518L, 705201608L, 1004857582L, 567772636L, 165575694L, 844687923L,
            1368533378L, 4002271268L, 1039570525L, 817963899L, 4160120938L, 2678890886L, 2084569206L, 2242703242L, 4105622048L, 3720562716L,
            1134472900L, 1903935075L, 2186934951L, 3598892392L, 2469037584L, 952044159L, 1645404871L, 2297311592L, 3015864391L, 1630784286L,
            355030278L, 1525047878L, 488672733L, 2837265850L, 3272971917L, 1789027915L, 1902972106L, 2300528982L, 2156293119L, 3176581191L,
            2425569882L, 685612679L, 2230271496L, 1762281942L, 1786707842L, 2882528256L, 1027335626L, 941319436L, 1266452002L, 1040336627L,
            2740328020L, 2491975260L, 988748786L, 1583179938L, 3543080412L, 1368861680L, 393879867L, 1184069058L, 929303504L, 4231210184L,
            118037001L, 761517051L, 559149091L, 1210202229L, 1638225958L, 2350081336L, 1240931736L, 2227688734L, 2236947059L, 332793029L,
            3607209510L, 2277000394L, 1948168861L, 707565436L, 3348613635L, 1816167895L, 766310299L, 1934598891L, 3425240407L, 4196300260L,
            112368167L, 3201182330L, 1889817931L, 3375731758L, 2808396737L, 535007702L, 2013786306L, 1080061657L, 3843371142L, 3911024082L,
            3982310313L, 2853484106L, 2209500633L, 3961517517L, 3123964627L, 3840897884L, 3154519096L, 3636450595L, 1195187716L, 537393319L,
            2955477997L, 2263517914L, 2511038927L, 4246706185L, 2629032123L, 1374968152L, 2631746166L, 3259336286L, 2399961963L, 1323817991L,
            4130770333L, 4012645825L, 3998659915L, 3177369135L, 4103170733L, 3357324692L, 1098030921L, 616493220L, 3740567465L, 573441464L,
            2369516998L, 297095177L, 2903102131L, 433823697L, 3611455621L, 870055051L, 1382781816L, 2030967752L, 2996406784L, 2774800131L,
            108450377L, 1804699084L, 820262031L, 2193960805L, 1472715812L, 1218191053L, 2680860714L, 1456869655L, 4270234796L, 1442599232L,
            2143007618L, 2656763001L, 268729497L, 4238301572L, 1448640045L, 3112276976L, 2566807182L, 699489131L, 2506223701L, 3138169381L,
            508480533L, 603273531L, 138785880L, 3472844746L, 2962853900L, 11621967L, 971961297L, 4240555908L, 2894631861L, 1686421262L,
            2445290163L, 2349599856L, 1752148166L, 3782328022L, 3752736735L, 3584140519L, 3823847841L, 1583355104L, 542843308L, 4250448858L,
            779880397L, 4012689498L, 3612900166L, 4095181949L, 2318454465L, 1889029996L, 4038472584L, 3256928653L, 3991284022L, 2462099379L,
            519270888L, 537261999L, 2443473509L, 2966377732L, 3573590952L, 3411823571L, 2604387267L, 3479585973L, 3465840879L, 4180334L,
            2856460847L, 1212478416L, 1303944567L, 141040302L, 1714371112L, 1981108955L, 502767994L, 2482957722L, 3427363407L, 2719469517L,
            1000589616L, 646938231L, 127382689L, 2347498577L, 109654212L, 382235874L, 3259161124L, 4213350262L, 2692307714L, 1755299894L,
            396834610L, 3524979712L, 2885723794L, 1528921880L, 2923566628L, 734026944L, 1220664186L, 1330537396L, 375910478L, 872550292L,
            2536187221L, 2584163675L, 23484784L, 2109082735L, 987172923L, 1547504064L, 4003715802L, 2294422544L, 270808791L, 1782264832L,
            3948035148L, 4221032598L, 2521610347L, 3716644920L, 86628941L, 185886885L, 410229448L, 4159858280L, 4132390001L, 1544877507L,
            1151369723L, 967605815L, 2316812907L, 2257542759L, 959551373L, 1860139031L, 1230097511L, 2486437875L, 3428742287L, 729737001L,
            3417514224L, 301910247L, 4241475160L, 54870868L, 926589420L, 492371610L, 105320622L, 2827657402L, 3515064894L, 1087459491L,
            4113676497L, 2816057221L, 293833941L, 2979947699L, 1030202857L, 2955696838L, 2579085800L, 1277176698L, 368206291L, 2823564557L,
            1358005670L, 867844565L, 964235283L, 1269822542L, 4008618524L, 3762848532L, 1436339499L, 2701456453L, 1668233156L, 642604603L,
            1975615285L, 1967276337L, 3138475833L, 1962833242L, 2100984486L, 764143492L, 2213352778L, 4230378456L, 1155353215L, 2030398664L,
            2194442289L, 2637962108L, 3913628666L, 607213204L, 1713320531L, 1968480092L, 3140183021L, 1742736790L, 4102645447L, 226224726L,
            3261043439L, 2840045469L, 3729448815L, 2886665026L, 3555402859L, 2762609038L, 1010723398L, 1165968449L, 2768912495L, 1817218463L,
            3920369895L, 516797626L, 967605818L, 2142438650L, 1866004712L, 1257040493L, 1627610739L, 2171635975L, 3955257861L, 2432529940L,
            3039633791L, 1817043349L, 500469892L, 1693337644L, 2496111905L, 1410075096L, 1977585109L, 1094791671L, 915996022L, 4152679247L,
            4173953539L, 76495289L, 1005908157L, 2360674706L, 2606291438L, 3853220300L, 2589941842L, 3180695984L, 4208075563L, 1516446292L,
            42395160L, 2329135351L, 3825598838L, 1967932951L, 1544571147L, 1870491647L, 562541610L, 1467287899L, 49596003L, 1516096006L,
            4266316999L, 1407295357L, 1509902005L, 3166972837L, 4247734935L, 3201751301L, 2506267499L, 564248795L, 2853221469L, 3874450776L,
            680709965L, 2683137040L, 507014135L, 2615199464L, 724506095L, 435530875L, 2063535730L, 836392815L, 807742644L, 1467572396L,
            376348250L, 2838973025L, 1899404438L, 2146969262L, 3893842726L, 3401317683L, 26286350L, 1771912254L, 917768994L, 3012887827L,
            2609421306L, 2771013639L, 2888372205L, 994986575L, 3075725526L, 1012080418L, 1479500839L, 2848822185L, 1416509870L, 607103698L,
            3537958727L, 167129693L, 1507100441L, 2910762606L, 3578865784L, 1457438621L, 1359472037L, 4055894692L, 2169293992L, 1611501808L,
            2615768601L, 2438964722L, 727066845L, 2738708314L, 1499330497L, 1768300893L, 1357677367L, 4057076594L, 249753339L, 2912841911L,
            2869768164L, 3475471197L, 1649957420L, 2203744324L, 1957821035L, 1236991957L, 782878820L, 311628200L, 3187284071L, 2211076503L,
            2635970329L, 2226878950L, 2654968306L, 826237185L, 463021147L, 3512569778L, 3472428929L, 692397709L, 3686593907L, 2969704582L,
            2665999389L, 486024439L, 2125082162L, 1774232245L, 1955873180L, 3797145555L, 1222262034L, 1169732977L, 3679261818L, 3626864094L,
            643633314L, 2963729306L, 2115802022L, 922627910L, 3702352640L, 88314257L, 2966312068L, 1641136905L, 2376477187L, 114359855L,
            3133594940L, 3391096563L, 2200023471L, 68265715L, 3901853356L, 564314450L, 2445333839L, 1789531386L, 3710035008L, 2295013493L,
            2051979283L, 1739563121L, 3638135964L, 837881159L, 1878108328L, 799731873L, 1218585019L, 1004967051L, 2860115867L, 245835660L,
            2050512879L, 1236794965L, 3575429425L, 68944269L, 12125441L, 1172994177L, 2411846607L, 3087741609L, 2880230121L, 1736170560L,
            3970753858L, 1835341035L, 834707447L, 1584143037L, 473505039L, 245200881L, 1897478445L, 1810477242L, 1637153399L, 1172709704L,
            1109609202L, 3273891174L, 2476522940L, 1444941212L, 1797739016L, 1729011L, 3435308358L, 1265773536L, 3995464375L, 1837551518L,
            2859196621L, 1305323446L, 2027203091L, 921336537L, 1059706624L, 3739889028L, 1785394621L, 414169116L, 3638880060L, 2326202554L,
            1703646425L, 2792769420L, 3483438114L, 626605172L, 2375426613L, 1603797616L, 1039592384L, 2390594298L, 3287176673L, 3589743687L,
            45152917L, 1387312416L, 1892860191L, 980409708L, 423274136L, 1419179989L, 1107858203L, 2051081964L, 2213046336L, 4103827340L,
            3124599377L, 1442139613L, 769987442L, 2600163099L, 984830982L, 2909077279L, 3346490622L, 2139505766L, 1097702612L, 2722665080L,
            3809183460L, 189936054L, 3127357142L, 3853198439L, 1610779536L, 496902342L, 712796458L, 1802050779L, 2656172055L, 2608217580L,
            1026110015L, 3487640424L, 1967867291L, 2720235591L, 3653588244L, 1809645505L, 1765696320L, 2184724455L, 420932191L, 3967536473L,
            1927157338L, 3885635095L, 2395497012L, 2834354820L, 550044198L, 2079950980L, 681935665L, 1053031022L, 1289783643L, 3277042896L,
            871302735L, 568713744L, 3367721117L, 3898460850L, 2892333727L, 2814350032L, 94771021L, 631573550L, 3855058807L, 1031078431L,
            1269472408L, 599640196L, 2522069975L, 3135039477L, 3263407236L, 3225476910L, 2473633857L, 791765026L, 921621041L, 2888612876L,
            331392155L, 3453036951L, 134123954L, 3447630797L, 738273053L, 407055864L, 1503423431L, 1978219866L, 3061477090L, 2389937686L,
            4287656957L, 2943812202L, 4168000252L, 2437979811L, 866618822L, 1333338954L, 980759996L, 892992689L, 822341202L, 1332682345L,
            1806953404L, 1287091541L, 2379344281L, 719209373L, 290594734L, 3108840773L, 2380176061L, 420034879L, 3079840317L, 1956398427L,
            3048607532L, 939809230L, 229464096L, 2972746843L, 689749330L, 3734657975L, 1373567329L, 1364943880L, 3396239934L, 942567028L,
            4005444977L, 1284443242L, 3866549482L, 350346364L, 1870644788L, 3481643331L, 3550390638L, 326007955L, 1902424836L, 4079948595L,
            901988404L, 3728332577L, 2443736121L, 3289387295L, 703691436L, 320251647L, 317822190L, 1108055193L, 4146966748L, 1762369427L,
            399592370L, 2408782520L, 561316028L, 2270434296L, 2561860669L, 3307181425L, 1422835146L, 119131257L, 4089907213L, 3827853169L,
            2750067661L, 1248526560L, 298780505L, 2122937209L, 1530038124L, 1586287862L, 216922724L, 2442838727L, 2987717555L, 243909516L,
            4039391801L, 3940615458L, 2203831814L, 2666283970L, 3928402390L, 1767053345L, 1730523722L, 3665932514L, 3585388083L, 135240187L,
            363347375L, 702531360L, 2447478799L, 672546136L, 2211514274L, 1319900314L, 2675038744L, 1641399546L, 3819645535L, 3350255167L,
            3016521002L, 1642844086L, 654292266L, 3984105023L, 2856044888L, 1163560840L, 3384836777L, 169602830L, 3264895614L, 353191733L,
            2486700512L, 1763792144L, 4010479017L, 995008435L, 3635793996L, 3349160872L, 2966749832L, 1686246261L, 3261130959L, 2224471340L,
            4283388981L, 263542284L, 2094484050L, 2472057984L, 2291620935L, 2210244765L, 2345419414L, 28847137L, 4253162943L, 642911047L,
            77086233L, 3554789927L, 2016172047L, 846198131L, 3243752647L, 1331587972L, 1156316155L, 3659979224L, 1826214030L, 387576280L,
            1901855879L, 741162130L, 1408936873L, 3162726726L, 1359778518L, 3767138346L, 1182799647L, 916390110L, 1894523697L, 237321557L,
            3673921303L, 3856503341L, 2509331745L, 2686463894L, 2707541063L, 3939477233L, 3982397833L, 3669522052L, 2763484490L, 4201662615L,
            1662980282L, 3550324985L, 1572126948L, 385737770L, 771716480L, 3044011134L, 3288314736L, 2389653180L, 1620563033L, 1364024630L,
            2779199458L, 964147635L, 4247888074L, 2419288283L, 3895922017L, 2551223584L, 2917285036L, 2583178756L, 1105100451L, 2225193621L,
            152640480L, 814943490L, 480224330L, 3288774359L, 4007436626L, 1632207004L, 2953420532L, 3321254821L, 1276147981L, 1929586796L,
    };

    /**
     * 计算字符串hash值
     * @param content 字符串内容
     * @return hash值
     */
    public static BigDecimal shash(byte [] content) {
        return shash(content, 1, true);
    }

    /**
     * 计算字符串hash值
     * @param content 字符串内容
     * @param hashType hash 类型 {1, 2}
     * @return hash值
     */
    public static BigDecimal shash(byte [] content, int hashType) {
        return shash(content, hashType, true);
    }

    /**
     * 转换成无符号数
     * @param value
     * @return
     */
    private static BigDecimal readUInt64(long value) {
        if (value >=0 ) {
            return new BigDecimal(value);
        }

        long lowValue = value & 0x7fffffffffffffffL;
        return BigDecimal.valueOf(lowValue).add(BigDecimal.valueOf(Long.MAX_VALUE)).add(BigDecimal.valueOf(1));
    }
    
    /**
     * 计算字符串hash值
     * @param content 字符串内容
     * @param hashType hash 类型 {1, 2}
     * @param caseSensitive 是否忽略大小写 true: 忽略大小写, false: 不忽略大小写
     * @return hash值
     */
    public static BigDecimal shash(byte [] content, int hashType, boolean caseSensitive) {
        
        long seed1 = 2146271213L;
        long seed2 = 4008636142L;

        int length = content.length;
        int index = 0;
        while (index < length) {
            
            byte ch = content[index];
            
            if (!caseSensitive) {
                if (ch >= 'A' && ch <= 'Z') {
                    ch += 'a' - 'A';
                }
            }
            
            seed1 = cryptTable[(hashType << 8) + ch] ^ (seed1 + seed2);
            seed2 = ch + seed1 + seed2 + (seed2 << 5) + 3;
            
            ++index;
        }
        
        return readUInt64(seed1);
    }
    
    public static void main(String... argv) {
        BigDecimal shash = StormHash.shash("大神官大人wo23".getBytes());
        BigDecimal mod = BigDecimal.valueOf(50);
        System.out.println(shash);
        System.out.println(shash.divideAndRemainder(mod)[1].longValue());
    }
}
